[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-07-27 13:41:30.780280", 
  "name": "Sales Invoice-Client", 
  "script": "frappe.ui.form.on('Sales Invoice', {\n    customer: function (frm) {\n        console.log(frm.doc.customer)\n        if (frm.doc.customer != null) {\n            frm.set_value('customer_optics', '')\n            cur_frm.fields_dict['customer_optics'].get_query = function (doc, cdt, cdn) {\n                console.log(doc.customer)\n                return {\n                    filters: {\n                        'customer': doc.customer,\n                        'docstatus': 0\n                    }\n                }\n            }\n        }\n    },\n    customer_optics: function (doc, dt, dn) {\n        var html = ''\n        if (cur_frm.doc.customer_optics != null) {\n            cur_frm.set_value('optics_detail', '')\n            frappe.call({\n                method: \"hamdan.hamdan.doctype.customer_optics.customer_optics.get_optics_detail\",\n                args: {\n                    customer_optics: cur_frm.doc.customer_optics\n                },\n                callback: function (r) {\n                    if (!r.message) {\n                        html = `There is no optics detail  ` + cur_frm.doc.customer_optics\n                        cur_frm.set_value('optics_detail', html)\n                    }\n                    const optics_data = r.message[0];\n                    console.log(optics_data)\n                    if (optics_data) {\n                        if (optics_data.optic_type == 'Glasses') {\n                            html = `\n                                <table class=\"table table-bordered table-sm\">\n                                <tr>\n                                <th>${optics_data.optic_type}</th>\n                                <th>SPH</th> \n                                <th>CYL</th>\n                                <th>AXIS</th>\n                                <th>PRISM</th>\n                                <th>VA</th>\n                              </tr>\n                                    <tbody>\n                                       <tr><td><span style=\"font-weight: bold\">\u0627\u0644\u0639\u064a\u0646 \u0627\u0644\u064a\u0645\u0646\u0649</br>Right Eye</td>\n                                       <td>${optics_data.re_sph|| \"\"}</td>\n                                       <td>${optics_data.re_cyl|| \"\"}</td>\n                                       <td>${optics_data.re_axis|| \"\"}</td>\n                                       <td>${optics_data.re_prism|| \"\"}</td>\n                                       <td>${optics_data.re_va|| \"\"}</td></tr>\n                                       <tr><td><span style=\"font-weight: bold\">\u0627\u0644\u0639\u064a\u0646 \u0627\u0644\u064a\u0633\u0631\u0649</br>Left Eye</td>\n                                       <td>${optics_data.le_sph|| \"\"}</td>\n                                       <td>${optics_data.le_cyl|| \"\"}</td>\n                                       <td>${optics_data.le_axis|| \"\"}</td>\n                                       <td>${optics_data.le_prism|| \"\"}</td>\n                                       <td>${optics_data.le_va|| \"\"}</td></tr>\n                                    </tbody>\n                                </table>\n                                <table class=\"table table-bordered table-sm\">\n                                <tr><td><span style=\"font-weight: bold\">I.P.D</td>\n                                <td>${optics_data.ipd|| \"\"}</td></tr>\n                                <tr><td><span style=\"font-weight: bold\">Add.</td>\n                                <td>${optics_data.add|| \"\"}</td></tr>                               \n                                </table>\n                                `\n\n                        } else {\n                            html = `\n                            <table class=\"table table-bordered table-sm\">\n                            <tr>\n                            <th>${optics_data.optic_type}</th>\n                            <th>brand</th> \n                            <th>B.C.</th>\n                            <th>POWEr</th>\n                            <th>DIA</th>\n                            <th>TINT</th>\n                          </tr>\n                                <tbody>\n                                   <tr><td><span style=\"font-weight: bold\">\u0627\u0644\u0639\u064a\u0646 \u0627\u0644\u064a\u0645\u0646\u0649</br>Right Eye</td>\n                                   <td>${optics_data.re_brand|| \"\"}</td>\n                                   <td>${optics_data.re_bc|| \"\"}</td>\n                                   <td>${optics_data.re_power|| \"\"}</td>\n                                   <td>${optics_data.re_dia|| \"\"}</td>\n                                   <td>${optics_data.re_tint|| \"\"}</td></tr>\n                                   <tr><td><span style=\"font-weight: bold\">\u0627\u0644\u0639\u064a\u0646 \u0627\u0644\u064a\u0633\u0631\u0649</br>Left Eye</td>\n                                   <td>${optics_data.le_brand|| \"\"}</td>\n                                   <td>${optics_data.le_bc|| \"\"}</td>\n                                   <td>${optics_data.le_power|| \"\"}</td>\n                                   <td>${optics_data.le_dia || \"\"}</td>\n                                   <td>${optics_data.le_tint || \"\"}</td></tr>\n                                </tbody>\n                            </table>       \n                            `\n                        }\n                        cur_frm.set_value('optics_detail', html)\n                    }\n                }\n            });\n        }\n    },\n    validate: function (doc, dt, dn) {\n        for (i = 0; i < cur_frm.doc.items.length; i++) {\n            if (Object.keys(JSON.parse(cur_frm.doc.items[i].item_tax_rate)).length != 0) {\n                var itemtaxrate = Object.values(JSON.parse(cur_frm.doc.items[i].item_tax_rate))[0];\n                cur_frm.doc.items[i].line_tax_rate = itemtaxrate;\n                cur_frm.doc.items[i].line_tax_amount = (cur_frm.doc.items[i].amount * itemtaxrate) / 100;\n                cur_frm.doc.items[i].line_total_tax_amount = cur_frm.doc.items[i].line_tax_amount + cur_frm.doc.items[i].amount;\n            } else {\n                cur_frm.doc.items[i].line_tax_rate = 0;\n                cur_frm.doc.items[i].line_tax_amount = 0.0;\n            }\n        }\n    }\n})\n", 
  "script_type": "Client"
 }
]